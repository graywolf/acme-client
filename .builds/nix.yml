image: nixos/latest
secrets:
  - a9acb8e7-4e6a-45fd-be82-569c31b5fae7
sources:
  - git@git.sr.ht:~graywolf/acme-client-portable
tasks:
  - nixpkgs: |
      mkdir nixpkgs && cd nixpkgs

      git init
      git remote add origin https://github.com/NixOS/nixpkgs-channels
      git fetch origin nixos-unstable --depth=1
      git checkout nixos-unstable
  - autoreconf: |
      cd acme-client-portable
      nix-shell --pure --attr acme-client ~/nixpkgs/default.nix --run \
        'autoreconf -i'
  - configure: |
      cd acme-client-portable
      nix-shell --pure --attr acme-client ~/nixpkgs/default.nix --run \
        './configure'
  - make: |
      cd acme-client-portable
      nix-shell --pure --attr acme-client ~/nixpkgs/default.nix --run \
        'make'
